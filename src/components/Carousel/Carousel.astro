---
interface Slide {
  title: string;
  body: string;
}

interface Props {
  slides: Slide[];
}

const { slides = [] } = Astro.props;
---

<div class="carousel card stack glass" data-carousel>
  <div class="glass-tint" aria-hidden="true"></div>
  <div class="glass-shine" aria-hidden="true"></div>

  <div class="slides">
    {
      slides.map((slide, idx) => (
        <article class={idx === 0 ? "slide active" : "slide"} data-index={idx}>
          <h3>{slide.title}</h3>
          <p>{slide.body}</p>
        </article>
      ))
    }
  </div>

  <div class="carousel-nav">
    <button class="nav-btn" type="button" data-dir="prev" aria-label="Previous slide">←</button>
    <div class="dots" aria-hidden="true">
      {slides.map((_, idx) => <span class={idx === 0 ? "dot active" : "dot"} data-index={idx} />)}
    </div>
    <button class="nav-btn" type="button" data-dir="next" aria-label="Next slide">→</button>
  </div>
</div>

<script>
  const carousels = Array.from(document.querySelectorAll("[data-carousel]"));

  carousels.forEach((carousel) => {
    const slides = Array.from(carousel.querySelectorAll(".slide"));
    const dots = Array.from(carousel.querySelectorAll(".dot"));
    const buttons = Array.from(carousel.querySelectorAll(".nav-btn"));
    let current = 0;

    const setActive = (index) => {
      current = (index + slides.length) % slides.length;
      slides.forEach((slide, i) => slide.classList.toggle("active", i === current));
      dots.forEach((dot, i) => dot.classList.toggle("active", i === current));
    };

    buttons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const dir = btn.dataset.dir === "next" ? 1 : -1;
        setActive(current + dir);
      });
    });
  });
</script>

<style>
  .carousel {
    position: relative;
    overflow: hidden;
    isolation: isolate;
    gap: var(--space-m);
    border-radius: 18px;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.54), rgba(255, 255, 255, 0.16));
    border: 1px solid rgba(255, 255, 255, 0.5);
    box-shadow:
      0 18px 45px rgba(0, 0, 0, 0.18),
      0 0 0 1px rgba(255, 255, 255, 0.08) inset;
    backdrop-filter: blur(14px) saturate(1.3);
    -webkit-backdrop-filter: blur(14px) saturate(1.3);
  }

  .glass-tint {
    position: absolute;
    inset: -20% 10% auto -10%;
    height: 260px;
    background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0));
    filter: blur(6px);
    opacity: 0.6;
    pointer-events: none;
  }

  .glass-shine {
    position: absolute;
    inset: 0;
    box-shadow:
      inset 2px 2px 1px rgba(255, 255, 255, 0.45),
      inset -2px -2px 6px rgba(0, 0, 0, 0.08);
    pointer-events: none;
  }

  .slides {
    position: relative;
    min-height: 200px;
    z-index: 1;
  }

  .slide {
    display: none;
  }

  .slide.active {
    display: grid;
    gap: var(--space-2xs);
  }

  .carousel-nav {
    position: relative;
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--space-s);
    z-index: 1;
  }

  .nav-btn {
    border: 1px solid rgba(255, 255, 255, 0.6);
    background: rgba(255, 255, 255, 0.35);
    color: inherit;
    border-radius: var(--radius-sm);
    padding: 0.4rem 0.7rem;
    font-weight: 700;
    cursor: pointer;
    transition:
      transform var(--transition),
      box-shadow var(--transition),
      background var(--transition);
  }

  .nav-btn:hover {
    transform: translateY(-1px);
    background: rgba(255, 255, 255, 0.5);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .dots {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .dot {
    width: 8px;
    height: 8px;
    border-radius: 999px;
    background: rgba(255, 255, 255, 0.5);
    transition:
      background 150ms ease,
      transform 150ms ease;
  }

  .dot.active {
    background: var(--color-text);
    transform: scale(1.1);
  }
</style>
